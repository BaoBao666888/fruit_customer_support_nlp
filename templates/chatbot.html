{% extends "base.html" %}
{% block title %}Chatbot Tr√°i C√¢y{% endblock %}

{% block content %}
<h2 class="text-center mb-4">Tr√≤ chuy·ªán c√πng tr·ª£ l√Ω tr√°i c√¢y üçç</h2>

<div class="card p-4 shadow">
    <div id="chatBox" class="border rounded bg-light mb-3 p-3" style="height: 400px; overflow-y: scroll;"></div>
    <div class="input-group">
        <input type="text" id="userInput" class="form-control" placeholder="H·ªèi v·ªÅ tr√°i c√¢y...">
        <button class="btn btn-primary" type="button" onclick="sendMessage()">G·ª≠i</button>
    </div>
</div>

<script>
    function appendMessage(sender, text) {
        const box = document.getElementById("chatBox");
        const msg = document.createElement("div");
        msg.classList.add("mb-2");
        msg.innerHTML = `<strong>${sender}:</strong> ${text}`;
        box.appendChild(msg);
        box.scrollTop = box.scrollHeight;
    }

    function sendMessage() {
        const input = document.getElementById("userInput");
        const userText = input.value;
        if (!userText.trim()) return;

        appendMessage("B·∫°n", userText);
        input.value = "";

        fetch("/chat_api", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ message: userText })
        })
        .then(res => res.json())
        .then(data => appendMessage("Bot", data.response));
    }

    document.getElementById("userInput").addEventListener("keypress", function (e) {
        if (e.key === "Enter") {
            e.preventDefault();
            sendMessage();
        }
    });
</script>
{% endblock %}